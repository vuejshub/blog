import{d as X,u as Z,e as T,f as ee,P as te,t as se,r as ae,g as C,h as w,i as s,j as re,w as _,k as le,R as F,l as ue,m as ie,n as oe,p as ne,q as ce,s as P,v as $,C as ve,x as pe,y as he,z as ye,A as de,B as me,D as ge,E as I,F as fe,G as x}from"./app-BrKqmITf.js";const He=["/","/intro.html","/css/","/css/scrollbar.html","/javaScript/","/javaScript/copy.html","/javaScript/debounce.html","/javaScript/deepClone.html","/javaScript/eventStream.html","/nodejs/","/nodejs/express-cors.html","/other/OneCloud.html","/other/","/other/follow.html","/typeScript/","/typeScript/interfacevstype.html","/vue/","/404.html","/category/","/category/css/","/category/javascript/","/category/nodejs/","/category/%E5%B7%A5%E5%85%B7/","/category/%E5%85%B6%E4%BB%96/","/category/other/","/category/typescript/","/category/vue/","/tag/","/tag/css-%E6%BB%9A%E5%8A%A8%E6%9D%A1/","/tag/javascript/","/tag/eventstream/","/tag/nodejs/","/tag/express/","/tag/%E5%88%86%E4%BA%AB/","/tag/typescript/","/article/","/star/","/timeline/"],Re="SEARCH_PRO_QUERY_HISTORY",m=I(Re,[]),Se=()=>{const{queryHistoryCount:r}=x;return{enabled:r>0,queryHistory:m,addQueryHistory:i=>{m.value=Array.from(new Set([i,...m.value.slice(0,r-1)]))},removeQueryHistory:i=>{m.value=[...m.value.slice(0,i),...m.value.slice(i+1)]}}},B=r=>He[r.id]+("anchor"in r?`#${r.anchor}`:""),ke="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:O}=x,g=I(ke,[]),we=()=>({enabled:O>0,resultHistory:g,addResultHistory:l=>{{const i={link:B(l),display:l.display};"header"in l&&(i.header=l.header),g.value=[i,...g.value.slice(0,O-1)]}},removeResultHistory:l=>{g.value=[...g.value.slice(0,l),...g.value.slice(l+1)]}}),xe=r=>{const l=ve(),i=T(),E=pe(),o=C(0),f=w(()=>o.value>0),p=he([]);return ye(()=>{const{search:Q,terminate:h}=de(),H=me(d=>{const R=d.join(" "),{searchFilter:y=a=>a,splitWord:D,suggestionsFilter:u,...n}=l.value;R?(o.value+=1,Q(d.join(" "),i.value,n).then(a=>y(a,R,i.value,E.value)).then(a=>{o.value-=1,p.value=a}).catch(a=>{console.warn(a),o.value-=1,o.value||(p.value=[])})):p.value=[]},x.searchDelay-x.suggestDelay);_([r,i],([d])=>H(d),{immediate:!0}),ge(()=>{h()})}),{isSearching:f,results:p}};var Qe=X({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(r,{emit:l}){const i=Z(),E=T(),o=ee(te),{addQueryHistory:f,queryHistory:p,removeQueryHistory:Q}=Se(),{resultHistory:h,addResultHistory:H,removeResultHistory:d}=we(),R=se(r,"queries"),{results:y,isSearching:D}=xe(R),u=ae({isQuery:!0,index:0}),n=C(0),a=C(0),L=w(()=>p.value.length>0||h.value.length>0),j=w(()=>y.value.length>0),q=w(()=>y.value[n.value]||null),U=()=>{const{isQuery:e,index:t}=u;t===0?(u.isQuery=!e,u.index=e?h.value.length-1:p.value.length-1):u.index=t-1},Y=()=>{const{isQuery:e,index:t}=u;t===(e?p.value.length-1:h.value.length-1)?(u.isQuery=!e,u.index=0):u.index=t+1},M=()=>{n.value=n.value>0?n.value-1:y.value.length-1,a.value=q.value.contents.length-1},z=()=>{n.value=n.value<y.value.length-1?n.value+1:0,a.value=0},G=()=>{a.value<q.value.contents.length-1?a.value+=1:z()},V=()=>{a.value>0?a.value-=1:M()},A=e=>e.map(t=>fe(t)?t:s(t[0],t[1])),J=e=>{if(e.type==="customField"){const t=ne[e.index]||"$content",[c,k=""]=ce(t)?t[E.value].split("$content"):t.split("$content");return e.display.map(v=>s("div",A([c,...v,k])))}return e.display.map(t=>s("div",A(t)))},S=()=>{n.value=0,a.value=0,l("updateQuery",""),l("close")},K=()=>s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},o.value.queryHistory),p.value.map((e,t)=>s("div",{class:["search-pro-result-item",{active:u.isQuery&&u.index===t}],onClick:()=>{l("updateQuery",e)}},[s(P,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},e),s("button",{class:"search-pro-remove-icon",innerHTML:$,onClick:c=>{c.preventDefault(),c.stopPropagation(),Q(t)}})]))])),N=()=>s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},o.value.resultHistory),h.value.map((e,t)=>s(F,{to:e.link,class:["search-pro-result-item",{active:!u.isQuery&&u.index===t}],onClick:()=>{S()}},()=>[s(P,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[e.header?s("div",{class:"content-header"},e.header):null,s("div",e.display.map(c=>A(c)).flat())]),s("button",{class:"search-pro-remove-icon",innerHTML:$,onClick:c=>{c.preventDefault(),c.stopPropagation(),d(t)}})]))]));return re("keydown",e=>{if(r.isFocusing){if(j.value){if(e.key==="ArrowUp")V();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const t=q.value.contents[a.value];f(r.queries.join(" ")),H(t),i.push(B(t)),S()}}else if(e.key==="ArrowUp")U();else if(e.key==="ArrowDown")Y();else if(e.key==="Enter"){const{index:t}=u;u.isQuery?(l("updateQuery",p.value[t]),e.preventDefault()):(i.push(h.value[t].link),S())}}}),_([n,a],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>s("div",{class:["search-pro-result-wrapper",{empty:r.queries.length?!j.value:!L.value}],id:"search-pro-results"},r.queries.length?D.value?s(le,{hint:o.value.searching}):j.value?s("ul",{class:"search-pro-result-list"},y.value.map(({title:e,contents:t},c)=>{const k=n.value===c;return s("li",{class:["search-pro-result-list-item",{active:k}]},[s("div",{class:"search-pro-result-title"},e||o.value.defaultTitle),t.map((v,W)=>{const b=k&&a.value===W;return s(F,{to:B(v),class:["search-pro-result-item",{active:b,"aria-selected":b}],onClick:()=>{f(r.queries.join(" ")),H(v),S()}},()=>[v.type==="text"?null:s(v.type==="title"?ue:v.type==="heading"?ie:oe,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[v.type==="text"&&v.header?s("div",{class:"content-header"},v.header):null,s("div",J(v))])])})])})):o.value.emptyResult:L.value?[K(),N()]:o.value.emptyHistory)}});export{Qe as default};
